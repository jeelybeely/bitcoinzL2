{"generator":"Code Snippets v3.6.9","date_created":"2025-03-06 22:55","snippets":[{"id":8,"name":"Stability AI Server Handler","code":"add_action('rest_api_init', function() {\n    register_rest_route('stability\/v1', '\/generate', [\n        'methods'             => 'POST',\n        'callback'            => 'handle_ai_request',\n        'permission_callback' => '__return_true',\n        'args'                => [\n            'prompt' => [\n                'required'         => true,\n                'validate_callback' => function($param) {\n                    return !empty(trim($param));\n                }\n            ]\n        ]\n    ]);\n});\n\nfunction handle_ai_request(WP_REST_Request $request) {\n    \/\/ Retrieve and sanitize prompt from frontend\n    $prompt = sanitize_text_field($request->get_param('prompt'));\n    if (empty($prompt)) {\n        return new WP_REST_Response(['error' => 'Prompt is required'], 400);\n    }\n\n    \/\/ Define API endpoint and headers\n    $api_url = 'https:\/\/api.stability.ai\/v2beta\/stable-image\/generate\/ultra';\n    $api_key = 'sk-BhmAd96pjTt0CqSQ4EnVYUlVlR8S4y6pkoNeD5oFQYVvJBEk'; \/\/ Replace with your actual API key\n\n    \/\/ Prepare data for multipart\/form-data\n    $fields = [\n        'prompt' => $prompt,\n        'output_format' => 'jpeg', \/\/ Change as needed\n        'model' => 'ultra',\n        'aspect_ratio' => '16:9',\n    ];\n\n    \/\/ Use CURL to send the request\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL, $api_url);\n    curl_setopt($ch, CURLOPT_POST, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_HTTPHEADER, [\n        \"Authorization: Bearer $api_key\",\n        \"Accept: image\/*\"\n    ]);\n\n    \/\/ Execute CURL request\n    $response = curl_exec($ch);\n    $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n    curl_close($ch);\n\n    \/\/ Handle response\n    if ($http_code !== 200) {\n        return new WP_REST_Response([\n            'error' => \"API error: {$response}\"\n        ], $http_code);\n    }\n\n    return new WP_REST_Response([\n        'image' => base64_encode($response)\n    ], 200);\n}\n\/\/ After $response = curl_exec($ch); add:\n$upload_dir = wp_upload_dir();\n$temp_dir = $upload_dir['basedir'] . '\/temp\/';\nwp_mkdir_p($temp_dir);\n$filename = 'ai-design-' . md5(uniqid()) . '.jpg';\nfile_put_contents($temp_dir . $filename, $response);\n$temp_url = $upload_dir['baseurl'] . '\/temp\/' . $filename;\nreturn new WP_REST_Response(['image' => $temp_url], 200);\n\n\n\n","active":true,"modified":"2025-03-06 22:53:43","revision":"73"}]}